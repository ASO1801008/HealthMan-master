<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <meta http-equiv="Content-Security-Policy" content="default-src * data: gap: https://ssl.gstatic.com; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
  <meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
  <meta http-equiv="Content-Script-Type" content="text/javascript">
  <script src="components/loader.js"></script>
  <script src="components/jquery/dist/jquery.js"></script>
  <script src="lib/onsenui/js/onsenui.min.js"></script>
  <link rel="stylesheet" href="components/loader.css">
  <link rel="stylesheet" href="lib/onsenui/css/onsenui.css">
  <link rel="stylesheet" href="lib/onsenui/css/onsen-css-components.css">
  <link rel="stylesheet" href="css/style.css">

<!--処理-->
  <script  type="text/javascript">
    //ニフクラ接続
    var applicationKey = "f5ba5a14acdaedc970aad09cecc9f3017655e4bf75d7d548d3e06df736f6377e";
    var clientKey = "83154da0be79123a725810f8112a60e333d1cf6ac8e5741d445829bd0f7fda86";
    var ncmb = new NCMB(applicationKey,clientKey);
    //各クラスを変数に格納
    var Profile = ncmb.DataStore("profile");
    var Goal = ncmb.DataStore("goal");
    var Nutrition = ncmb.DataStore("nutrition");
    var Schedule = ncmb.DataStore("schedule");
    var Weight = ncmb.DataStore("weight");
    //カメラ処理
    var currentUser;
    var imgFlag = false;
    //カメラ処理
    function onLoadFunc3(){
      var currentUser = ncmb.User.getCurrentUser();
      // フィールドを空に
                    onDeleteMyPageField();
                    // カレントユーザーの objectId を取得
                    var objectId = currentUser.get("objectId");
                    // 参照権限（ACL）としてカレントーユーザーにのみ読み書き権限が付与されているデータを指定
                    var aclQueryStr = '{"*":{"read":true},"' + objectId + '":{"read":true,"write":true}}';
                    aclQuery = JSON.parse(aclQueryStr);

                    ncmb.File
                            .equalTo("acl", aclQuery) 
                            .order("createDate",true) // 作成日の降順を指定
                            .limit(10) // 取得件数を10件で指定
                            .fetchAll()
                            .then(function(results){
                                // ファイルデータ取得成功時の処理
                                console.log("ファイルデータ取得成功(myFile)");

                                var promises = [];
                                for (var i = 0; i < results.length; i++) {
                                    var object = results[i];
                                    // ファイルデータを元にPromiseを使って１件ずつ同期処理でファイルストアから画像を取得
                                    promises.push(downloadMyFile(object, i)); 
                                }

                                /*** Promise ***/
                                Promise.all(promises)
                                            .then(function(results) {
                                                // 全てのPromise処理成功時の処理
                                                console.log("全てのPromise処理に成功(myFile)：" + results + " OK");
                                                // loading の表示を終了
                                                //$.mobile.loading('hide');
                                            })
                                            .catch(function(error){
                                                // 全てのPromise処理成功時の処理
                                                console.log("Promise処理に失敗(myFile)：" + error);
                                                alert("Promise処理に失敗(myFile)" );
                                                // loading の表示を終了
                                                //$.mobile.loading('hide');
                                            });
                            })
                            .catch(function(error){
                                // ファイルデータ取得失敗時の処理
                                console.log("ファイルデータ取得失敗(myFile)：" + error);
                                alert("Promise処理に失敗(myFile)" );
                                // loading の表示を終了
                                $.mobile.loading('hide');
                            });
                }
                function downloadMyFile(object, i) {
                    /*** Promise ***/
                    return new Promise(function(resolve, reject) {
                        //  画像・作品名の表示先を指定
                        var myImageId = "myImage_" + i;
                        var myTitleId = "myTitle_" + i;

                        // ファイルデータからファイル名を取得
                        var fileName = object.fileName;
                        var fileName_encode = encodeURI(fileName);

                        // ダウンロード（データ形式をblobを指定）
                        ncmb.File.download(fileName_encode, "blob")
                                      .then(function(blob) {
                                          // ファイルダウンロード成功時の処理
                                          var reader = new FileReader();
                                          reader.onload = function(e) {
                                              // 画像URLを設定
                                              var dataUrl = reader.result;
                                              document.getElementById(myImageId).src = dataUrl;
                                              //  ファイル名を分解
                                              var fileNameArray = fileName.split('_');
                                              // 作品名を表示
                                              var imageName = "「" + fileNameArray[0] + "」";
                                              document.getElementById(myTitleId).innerHTML = imageName;
                                          }
                                          // ファイルリーダーにデータを渡す
                                          reader.readAsDataURL(blob);                        
                                      
                                          resolve("画像" + i); 
                                      })
                                      .catch(function(error) {
                                          // ファイルダウンロード失敗時の処理
                                          reject("画像" + i);
                                      });
                    });
                };

                function onDeleteHomeScreenPageField() {
                    // フィールドを空に
                    $("#imgName").val("");
                    $("#photo").val("");
                    $("#preview").empty();
                }

                function onDeleteMyPageField() {
                    // フィールドを空に
                    $("#myImage_0").attr("src", "");
                    $("#myImage_1").attr("src", "");
                    $("#myImage_2").attr("src", "");
                    $("#myImage_3").attr("src", "");
                    $("#myTitle_0").html("");
                    $("#myTitle_1").html("");
                    $("#myTitle_2").html("");
                    $("#myTitle_3").html("");
                }

    


    
    //スケジュール詳細画面の表示用処理
    function onLoadFunc2(dater){
        var currentUser = ncmb.User.getCurrentUser();
        if(currentUser) {
        //一旦カードをすべて消去する
          var maincont = document.getElementById('detaildiv');
          if (maincont.hasChildNodes()){
            for (var i=maincont.childNodes.length-1; i>=0; i--) {
              maincont.removeChild(maincont.childNodes[i]);
            }
          }
          //【ユーザー絞る】
          Schedule.equalTo("user_id",currentUser.get("objectId"))
                  .equalTo("date",dater)
                  .fetchAll()
                  .then(function(results){
              for(var i = 0; i < results.length; i++){
                tmp = results[i];
                //カード作成
                var onscard = document.createElement('ons-card');
                //pタグ作成
                var cardp = document.createElement('p');
                //取得データをpタグに入れる
                cardp.innerHTML = results[i].detail; // <- あとで編集
                //カードの中にpタグを入れる
                onscard.appendChild(cardp);
                //ボタンを作成
                var cardbutton = document.createElement('ons-button');
                //ボタンの設定
                cardbutton.setAttribute("style","width:45%; text-align:center;background-color:#ffff00;color:#000000; border-radius:10px;margin-right:15px;");
                //ボタンの文字
                cardbutton.innerHTML = "編集";
                 //ボタンを押した時の処理
                cardbutton.onclick = (function(objid) {
                  return function() {
                    document.querySelector('#navigator').pushPage('scheduleregister.html',{data:{date:dater,objId:objid.objectId,detail:objid.detail}});
                  }
                })(results[i]);

                //ボタンを作成
                var cardbuttonb = document.createElement('ons-button');
                //ボタンの設定
                cardbuttonb.setAttribute("style","width:45%; text-align:center;background-color:#ffff00;color:#000000; border-radius:10px;margin-left:15px;");
                //ボタンの文字
                cardbuttonb.innerHTML = "削除";
                 //ボタンを押した時の処理
                cardbuttonb.onclick = (function(objid) {
                  return function() {
                    console.log(objid);
                    btnDelete(objid);
                  }
                })(results[i].objectId);
                //カードの中にボタンを入れる
                onscard.appendChild(cardbutton);
                //カードの中にボタンを入れる
                onscard.appendChild(cardbuttonb);
                //divの中にカードを入れる
                maincont.appendChild(onscard);
              }
            })
            
            //削除ボタンを押したときの処理
            function btnDelete(objId){
              Schedule.equalTo("objectId",objId)
                      .fetch()
                      //成功時報酬
                      .then(function(result){
                        result.delete();
                        alert("削除");
                        onLoadFunc2(dater);
                      })
                      //削除失敗時の処理
                      .catch(function(error){
                        alert("削除失敗");
                      });
            }
            
        }   
      }
    
    document.addEventListener('init',function(event) {
      var page = event.target;
      
      //新規登録ページの処理
      if (page.matches('#signup-page')){
        //新規登録ボタン押下処理
        page.querySelector('#signup-button').onclick = function(){
          var user = new ncmb.User();
          // ユーザー名・パスワードを取得し設定
          user.set("userName", document.getElementById("newusername").value)
              .set("password", document.getElementById("newpassword").value)
          user.signUpByAccount()
              .then(function(){
                // 登録後処理
                 document.querySelector('#navigator').pushPage('signin.html');
              })
              .catch(function(err){
                // エラー処理
              });
          }
          page.querySelector('#signin-button').onclick = function(){
            document.querySelector('#navigator').popPage();
          };
          

      //ログインページの処理
      }else if(page.matches('#signin-page')){
        // 自動ログイン
        (async () => {
          let user = ncmb.User.getCurrentUser();
          console.log(user);
          if (!user) return; // 未認証であれば終了
          try {
            // 会員情報の取得を試みる
            await ncmb.User
              .equalTo('objectId', user.get('objectId'))
              .fetch();
            console.log("セッションの取得");
          } catch (e) {
            // セッションの有効期限切れ
            console.log("セッションの有効期限切れ");
            user = null;
            localStorage.removeItem("NCMB/"+ncmb.apikey+"/currentUser");
          }
          // セッションがある時、ログインする
          ncmb.User.login(user)
              .then(function(data){
                // ログイン後処理
                console.log("rogin");
                document.querySelector('#navigator').pushPage('common.html');
              })
              .catch(function(err){
                // エラー処理
                console.log("no");
              });
        })();
        //ログインボタン押下処理
         page.querySelector('#signin-button').onclick = function() {
           //ユーザー名とパスワードでログイン
          ncmb.User.login(document.getElementById("username").value, document.getElementById("password").value)
              .then(function(data){
                // ログイン後処理
                document.querySelector('#navigator').pushPage('common.html');
              })
              .catch(function(err){
                // エラー処理
                alert("ユーザー名またはパスワードが違います");
              });
        };
        page.querySelector('#signup-button').onclick = function(){
            document.querySelector('#navigator').pushPage('signup.html');
          };

      //目標ページの処理
      }else if(page.matches('#goal-page')){
           var currentUser = ncmb.User.getCurrentUser();
        if (currentUser) {
          page.querySelector("ons-back-button").onclick = function () {
              ncmb.User.logout();
              document.querySelector('#navigator').pushPage('signin.html');
          };
          page.querySelector("#newgoal-button").onclick = function () {
            document.querySelector('#navigator').pushPage('newgoal.html');
          };
          onLoadFunc();
        }
      
      
      //登録画面の処理
      }else if(page.matches('#newgoal-page')) {
        var currentUser = ncmb.User.getCurrentUser();
        if (currentUser) {
          page.querySelector("ons-back-button").onclick = function () {
              ncmb.User.logout();
              document.querySelector('#navigator').popPage();
          };
  
          page.querySelector("#new-button").onclick = function() {
            var v_goal = document.getElementById("target").value;
            if(v_goal == 0){
                document.getElementById("eee").textContent = "目標を入力してください";
            }else if(v_goal.length > 30){
                document.getElementById("eee").textContent = "30字以内で入力してください";
            }else{
                var goal = new Goal;
                //目標登録
                goal.set("goal", document.getElementById("target").value)
                    .set("user_id",currentUser.get("objectId"))
                    .set("flag",false)
                    .save()
                .then(function(object){
                onLoadFunc(); //onLoadFuncを呼び出し
                });
                document.querySelector("#navigator").popPage();
            }
            };
            }
      
      //スケジュールページの処理
      } else if (page.matches('#schedule-page')){
        var currentUser = ncmb.User.getCurrentUser();
        var schedule = new Schedule;
        if (currentUser) {
          page.querySelector("ons-back-button").onclick = function () {
            ncmb.User.logout();
            document.querySelector('#navigator').pushPage('signin.html');
          };
        var flag;
        var m = 0;
        var y = 0;
        var d = 0;
        MAXEVENT = 50;  //祝日＋予定最大数
        SHOWWEEK = 5;   //何週表示するか

        //表示スタイルオプション
        WIDTH    = "80px";  //１マスの幅   <td width="***">
        HEIGHT   = "60px";  //１マスの高さ <tr height="***">
        DEFAULT  = "bordercolor='#cc8066' bgcolor='#fff9f6' style='font-size:9pt; color:#993333;'";
          //枠線の色とフォントサイズ．デフォルトの背景色と文字色とかも<table ***>
        TODAY    = "bgcolor='#e6fff6'";  //今日のセルオプション<td ***>
        HOLIDAY  = "bgcolor='#ffe6e6'";  //日曜・祝日のセルオプション
        SATURDAY = "bgcolor='#e6e6ff'";  //土曜のセルオプション
        USUALDAY = "";  //なんでもない日のセルオプション
        SUN = "bgcolor='#f9d9c3' style='color:#ff0000;'"; //１列目日曜のセルオプション
        SAT = "bgcolor='#f9d9c3' style='color:#0000ff;'"; //１列目土曜のセルオプション
        MON = "bgcolor='#f9d9c3'"; //１列目月曜～金曜のセルオプション

        weekTable = new Array("sun","mon","tue","wed","thu","fri","sat");
        monthTable= new Array(31,28,31,30,31,30,31,31,30,31,30,31); 
        var dateObj = new Date();
        y = dateObj.getFullYear();
        m = dateObj.getMonth() + 1;
        d = dateObj.getDate();
        var glbl_day = new Array("","","","","","","");
        for(w=0; w<5; w++){
          glbl_day[w] = new Array("","","","","","","","","");
        }
        document.getElementById("currentDate").innerHTML = y+"年"+m+"月";
        showCalendar(new Date(y,m-1,1));

        for(i=0; i<SHOWWEEK; i++){
         for(j=0; j<7; j++){
            // masatokg
            page.querySelector("#detail-buttona" + i + "b" + j).onclick =  function (event) { 
                // 選択した行列番号をid文字列から取得
                mdarray = event.target.id.toString().replace('detail-buttona','').split('b');
                cal_row = Number(mdarray[0]);
                cal_col = Number(mdarray[1]);
                // 選択した日付のオブジェクト
                calDate = glbl_day[cal_row][cal_col];
                // innerHTML(currentDate)に選択した日付を表示
                document.getElementById("currentDate").innerHTML = y + "年" + (calDate.getMonth()+1) + "月" + calDate.getDate() + "日 ";
                document.querySelector('#navigator').pushPage('scheduledetail.html',{data:{date:calDate}});//// データを引き渡すならオプションの第２引数を使う
              };
          }
        }

        page.querySelector("#back-button").onclick = function () {
          if(m <=1){
            y = y-1;
            m = 12;
          }else{
            m = m-1;
          }
          document.getElementById("currentDate").innerHTML = y+"年"+m+"月";
          showCalendar(new Date(y,m-1,1));
          for(i=0; i<SHOWWEEK; i++){
            for(j=0; j<7; j++){
                // masatokg
                page.querySelector("#detail-buttona" + i + "b" + j).onclick =  function (event) { 
                    
                    // 選択した行列番号をid文字列から取得
                    mdarray = event.target.id.toString().replace('detail-buttona','').split('b');
                    cal_row = Number(mdarray[0]);
                    cal_col = Number(mdarray[1]);
                    // 選択した日付のオブジェクト
                    calDate = glbl_day[cal_row][cal_col];
                    // innerHTML(currentDate)に選択した日付を表示
                    document.getElementById("currentDate").innerHTML = y + "年" + (calDate.getMonth()+1) + "月" + calDate.getDate() + "日 ";
                    document.querySelector('#navigator').pushPage('scheduledetail.html',{data:{date:calDate}});//// データを引き渡すならオプションの第２引数を使う
                  };
            }
          }
          }
        
        page.querySelector("#next-button").onclick = function () {
          if(m >= 12){
            y = y+1;
            m = 1;
          }else{
            m = m+1;
          }
          document.getElementById("currentDate").innerHTML = y+"年"+m+"月";
          showCalendar(new Date(y,m-1,1));
          for(i=0; i<SHOWWEEK; i++){
            for(j=0; j<7; j++){
            // masatokg
            page.querySelector("#detail-buttona" + i + "b" + j).onclick =  function (event) {
                
                // 選択した行列番号をid文字列から取得
                mdarray = event.target.id.toString().replace('detail-buttona','').split('b');
                cal_row = Number(mdarray[0]);
                cal_col = Number(mdarray[1]);
                // 選択した日付のオブジェクト
                calDate = glbl_day[cal_row][cal_col];
                // innerHTML(currentDate)に選択した日付を表示
                document.getElementById("currentDate").innerHTML = y + "年" + (calDate.getMonth()+1) + "月" + calDate.getDate() + "日 ";
                document.querySelector('#navigator').pushPage('scheduledetail.html',{data:{date:calDate}});//// データを引き渡すならオプションの第２引数を使う
              };
          }
        }
        }
          
        /*** スケジュール登録 notice ***
          予定はsetSchedules()に書く．
          newSchedule( 年，月, 日，"td セルオプション", "予定" );
          日
          －calDate( 年, 月, 週, 曜日0(sun)..6(sat))を使えば，
          第n×曜日 形式の指定も可能です．
          td セルオプション <td ここ>
          －指定なしは""で．
          －悪いがフォントカラーはスタイルシート("style='color:white'")で指定してくれ．
          －同じ日に複数登録したりすると効かない事があるから注意．
          "予定"
          －HTMLタグ使えます．
          祝日とあわせてMAXEVENT件までスケジュールを設定可能
          *** notice スケジュール登録 ***/
          

          //year年month月 第week day曜日の計算
          function calDate( year, month, week, day ){
            var tmp, day1;
            tmp = new Date(year, month-1, 1);
            day1 = tmp.getDay();
            tmp = 1 + day - day1 + week*7;
            if( day - day1 >= 0 ) tmp = tmp - 7;
            return tmp;
          }

          // 春分の日を求める(2000～2099)
          function vernal( year ){
            var tmp = Math.floor( 20.69115 + 0.242194 * (year - 2000)- Math.floor((year - 2000)/4) );
            return tmp;
          }

          // 秋分の日を求める(2000～2099)
          function autumn( year ){
            var tmp = Math.floor( 23.09 + 0.242194 * (year - 2000)- Math.floor((year - 2000)/4) );
            return tmp;
          }

          function newEvent( date, sel, name ){
            if( si >= MAXEVENT ) return;
            sdlDate[si]  = date;
            sdlSel[si]   = sel;
            sdlName[si]  = name;
            si++;
          }

          function newSchedule( year, month, date, sel, name ){
            newEvent( new Date( year, month-1, date ), sel, name );
          }

          function Holiday( year, month, date, name ){
            var i, tmp;
            month--;
            tmp = new Date( year, month, date );
            newEvent( tmp, HOLIDAY, name );
            
            //振替休日、国民の休日計算用データ登録
            if( hi >= MAXEVENT ) return;
            //インサーションソート
            for( i=hi-1; i>=0 && holDate[i].getMonth() == month && holDate[i].getDate() > date; i-- ){
              holDate[i+1]  =  holDate[i];
            }
            holDate[i+1]  =  tmp;
            hi++;
          }

          //dateを基準にdis日動かした日を返す
          function moveDate( date, dis ){
            var d, m, y;
            d = date.getDate();
            m = date.getMonth();
            y = date.getFullYear();
            if ( ((y%4)==0 && (y%100)!=0) || (y%400)==0 ) //うるうの判定(2000～)
                  monthTable[1] = 29;
            else  monthTable[1] = 28;
            
            d = d + dis;
            while( d > monthTable[m]){
              d = d - monthTable[m];
              m++;
              if( m > 11 ){
                m=0;
                y++;
                if ( ((y%4)==0 && (y%100)!=0) || (y%400)==0 ) //うるうの判定(2000～)
                      monthTable[1] = 29;
                else  monthTable[1] = 28;
              }
            }
            while( d < 0 ){
              m--;
              if( m < 0 ){
                m=11;
                y--;
                if ( ((y%4)==0 && (y%100)!=0) || (y%400)==0 ) //うるうの判定(2000～)
                      monthTable[1] = 29;
                else  monthTable[1] = 28;
              }
              d = d + monthTable[m];
            }
            return (new Date(y,m,d));
          }

          //Main関数
          function showCalendar( argDate ){
            var i, j, k, tmpDate;
            tmp = argDate.getMonth() + 1;
            
            //スケジュール登録用領域確保
            sdlDate  = new Array(MAXEVENT);
            sdlSel   = new Array(MAXEVENT);
            sdlName  = new Array(MAXEVENT);
            si = 0;
            
            //覚えとく
            gBaseDate = argDate;
            //argDateの週の日曜日から表示する
            tmpDate = moveDate( argDate, -argDate.getDay() );
            //"今日"を記憶
            cal_toDayDate = new Date();
            
            //描画用コード開始
            docubuf = "<table border='3' cellspacing='0' " + DEFAULT + ">";
            //曜日
            docubuf += "<tr>";
            for(i=0; i<7; i++){
              docubuf += "<td align='center' ";
              if(i==0)      docubuf += SUN + "><strong>" + weekTable[i] +     "<\/strong>";
              else if(i==6) docubuf += SAT + "><strong>" + weekTable[i] + "<\/strong>";
              else          docubuf += MON + "><strong>" + weekTable[i] + "<\/strong>";
              docubuf += "<\/td>";
            }
            docubuf += "<\/tr>";
            
            //日付
            for(i=0; i<SHOWWEEK; i++){
              docubuf += "<tr valign='top' height='" + HEIGHT + "'>";
              for(j=0; j<7; j++){
                docubuf += "<td width='" + WIDTH + "' ";
                
                // masatokg
                glbl_day[i][j] = tmpDate; // カレンダーの各行・列セルに対応した日付オブジェクトを格納
                
                //セル色は最後に登録したの優先．
                for(k=si-1; k>=0; k--)
                  if( sdlDate[k].getDate()  == tmpDate.getDate()  &&
                      sdlDate[k].getMonth() == tmpDate.getMonth() &&
                      sdlDate[k].getYear()  == tmpDate.getYear() &&
                      sdlSel[k] != ""
                    )
                    break;
                cal_Today = cal_toDayDate.getDate();
                cal_Month = cal_toDayDate.getMonth();
                
                //セル色設定
                if( tmpDate.getDate()  == cal_toDayDate.getDate()  &&
                    tmpDate.getMonth() == cal_toDayDate.getMonth() )
                                  docubuf += TODAY     + ">";
                                  //別に１年前の今日に色付けてもいいか
                else if( k >= 0 ) docubuf += sdlSel[k] + ">";
                else if(j==0)     docubuf += HOLIDAY   + ">";
                else if(j==6)     docubuf += SATURDAY  + ">";
                else              docubuf += USUALDAY  + ">";
                
                //日付表示
                docubuf += "<ons-button id='detail-buttona" + i + "b" + j + "' modifier='quiet'>";
                // docubuf += "<ons-back-button>  BACK </ons-back-button>"
                //docubuf += "<ons-button ng-click=\"app.navi.pushPage('scheduledetail.html')\" modifier='quiet' >"
                //年初めは年から表示
                if( tmpDate.getDate()==1 && tmpDate.getMonth()==0 )
                  docubuf += tmpDate.getFullYear() + "/";
                //最初と月初めは月から表示
                if( tmpDate.getDate()==1 || (i==0 && j==0) )
                  docubuf += tmpDate.getMonth()+1 + "/";
                //普通は日だけ表示
                // docubuf += tmpDate.getDate() + "<br>";
                docubuf += tmpDate.getDate() + "<br>";
                

                //日を進める
                docubuf += "<div id = 'mark" + tmpDate.getFullYear() + (tmpDate.getMonth()+1) + tmpDate.getDate() + "'><\/div>"
                docubuf += "<\/ons-button>";
                tmpDate = moveDate(tmpDate,1);
                docubuf += "<\/td>";
              }
              docubuf += "<\/tr>";
            }
            docubuf += "<\/table>";
            divSdlCal.innerHTML = docubuf;
            /***for(i=0; i<SHOWWEEK; i++){
              for(j=0; j<7; j++){
                var q = i;
                var a = j;
                Schedule.equalTo("user_id",currentUser.get("objectId"))
                  .equalTo("date",glbl_day[i][j])
                  .fetchAll()
                  .then(function(results){
                      if(results.length > 0){
                        console.log(glbl_day[q][a]);
                      }
                  })
              }
            }***/
            
          }
        }
        
      //スケジュール詳細ページの処理
      }else if(page.matches('#scheduledetail-page')){
        var currentUser = ncmb.User.getCurrentUser();
        if (currentUser) {
        var len;
        page.querySelector("ons-back-button").onclick = function () {
            document.querySelector('#navigator').popPage;
          };
        page.querySelector("#newschedulebutton").onclick = function() {
          document.querySelector('#navigator').pushPage('scheduleregister.html',{data:{date:page.data.date,flag:0}});
        };
              
        currentDate2.innerHTML = page.data.date.getFullYear() + "年" + (page.data.date.getMonth()+1) + "月" + page.data.date.getDate() + "日 ";
        onLoadFunc2(page.data.date);
        }
      //スケジュール登録ページの処理
      }else if(page.matches('#scheduleregister-page')){
        var currentUser = ncmb.User.getCurrentUser();
        if (currentUser) {
          var callDate = page.data.date;
          var date = new Date(callDate.getFullYear(),callDate.getMonth(), callDate.getDate());
          page.querySelector("ons-back-button").onclick = function () {
              document.querySelector('#navigator').popPage();
          };
          currentDate3.innerHTML = date.getFullYear() + "年" + (date.getMonth()+1) + "月" + date.getDate() + "日 ";
          //追加ボタンを押したか、編集ボタンを押したかの判断
          if(page.data.flag == 0){
            //追加ボタンを押して遷移した場合の処理
            page.querySelector("#newschedulebutton").onclick = function() {
                var schedule = new Schedule;
                var inpw = document.getElementById("target").value;
                //バリデーションチェック
                if(inpw == 0){  //未入力
                    document.getElementById("weival").textContent = '必ず入力してください';
                }else if(String(inpw).length > 15){  //5桁以上の入力
                    document.getElementById("weival").textContent = '１５文字以内で入力してください';
                }else{
                //スケジュール登録
                schedule.set("detail", document.getElementById("target").value)
                        .set("user_id",currentUser.get("objectId"))
                        .set("date",date)
                        .save()
                        .then(function(object)
                        {
                          onLoadFunc2(callDate);
                        })
                        .catch(function(error)
                        {alert("保存失敗:"+JSON.stringify(error));
                        });
                
                document.querySelector("#navigator").popPage();
                }
            };
          }else{
            //編集ボタンを押して遷移した場合の処理
            target.innerHTML = page.data.detail;
            page.querySelector("#newschedulebutton").onclick = function() {
            var schedule = new Schedule;
            var inpw = document.getElementById("target").value;
            //バリデーションチェック
            if(inpw == 0){  //未入力
                document.getElementById("weival").textContent = '必ず入力してください';
            }else if(String(inpw).length > 15){  //5桁以上の入力
                document.getElementById("weival").textContent = '１５文字以内で入力してください';
            }else{
            Schedule.equalTo("objectId", page.data.objId)
                      .fetch()
                      //成功時報酬
                      .then(function(result){
                          //スケジュールupdate
                          result.set("detail", document.getElementById("target").value);
                          return result.update();
                        })
                        .then(function(results){
                          console.log("更新成功");
                          onLoadFunc2(callDate);
                        });
            document.querySelector("#navigator").popPage();
            }
            }
          }
        }
      //アルバムページの処理
      }else if(page.matches('#album-page')){
         var currentUser = ncmb.User.getCurrentUser();
        if (currentUser) {
          page.querySelector("ons-back-button").onclick = function () {
              document.querySelector('#navigator').pushPage('signin.html');
          };
        }
          page.querySelector('#camerachange-button').onclick = function(){
                        document.querySelector('#navigator').pushPage('Camera.html');
          };
          onLoadFunc3();

          $(function() {
                  //$.mobile.defaultPageTransition = 'none';
                  $("#myFilesBtn").click(onMyFilesBtn);
                  
                  $('form').on('change', 'input[type="file"]', function(e) {
                      file = e.target.files[0],
                      reader = new FileReader(),
                      t = this;

                      fileType = file.type.indexOf("image");

                      // 画像ファイル以外の場合は何もしない
                      if(fileType < 0){
                          alert("画像ファイルを選択してください");
                          return false;
                      }

                      // ファイル読み込みが完了した際のイベント登録
                      reader.onload = (function(file) {
                          imgFlag = true;
                          return function(e) {
                          //既存のプレビューを削除
                          $("#preview").empty();
                          // .previewの領域の中にロードした画像を表示するimageタグを追加
                          $("#preview").append($('<img id="photo_image">').attr({
                              src: e.target.result,
                              width: "100%",
                              class: "preview",
                              title: file.name
                          }));
                        };
                      })(file);

                      reader.readAsDataURL(file);
                    });
              });

          

          
          // ファイルストアに格納されたファイルデータ（画像本体以外の情報）を取得＜自分の作品＞
                function getMyFileData(){
                    // フィールドを空に
                    onDeleteMyPageField();
                    // カレントユーザーの objectId を取得
                    var objectId = currentUser.get("objectId");
                    // 参照権限（ACL）としてカレントーユーザーにのみ読み書き権限が付与されているデータを指定
                    var aclQueryStr = '{"*":{"read":true},"' + objectId + '":{"read":true,"write":true}}';
                    aclQuery = JSON.parse(aclQueryStr);

                    ncmb.File
                            .equalTo("acl", aclQuery) 
                            .order("createDate",true) // 作成日の降順を指定
                            .limit(10) // 取得件数を10件で指定
                            .fetchAll()
                            .then(function(results){
                                // ファイルデータ取得成功時の処理
                                console.log("ファイルデータ取得成功(myFile)");

                                var promises = [];
                                for (var i = 0; i < results.length; i++) {
                                    var object = results[i];
                                    // ファイルデータを元にPromiseを使って１件ずつ同期処理でファイルストアから画像を取得
                                    promises.push(downloadMyFile(object, i)); 
                                }

                                /*** Promise ***/
                                Promise.all(promises)
                                            .then(function(results) {
                                                // 全てのPromise処理成功時の処理
                                                console.log("全てのPromise処理に成功(myFile)：" + results + " OK");
                                                // loading の表示を終了
                                                //$.mobile.loading('hide');
                                            })
                                            .catch(function(error){
                                                // 全てのPromise処理成功時の処理
                                                console.log("Promise処理に失敗(myFile)：" + error);
                                                alert("Promise処理に失敗(myFile)" );
                                                // loading の表示を終了
                                                //$.mobile.loading('hide');
                                            });
                            })
                            .catch(function(error){
                                // ファイルデータ取得失敗時の処理
                                console.log("ファイルデータ取得失敗(myFile)：" + error);
                                alert("Promise処理に失敗(myFile)" );
                                // loading の表示を終了
                                $.mobile.loading('hide');
                            });
                }

                // ファイルストアから画像を取得して「MY イラスト」に表示
                function downloadMyFile(object, i) {
                    /*** Promise ***/
                    return new Promise(function(resolve, reject) {
                        //  画像・作品名の表示先を指定
                        var myImageId = "myImage_" + i;
                        var myTitleId = "myTitle_" + i;

                        // ファイルデータからファイル名を取得
                        var fileName = object.fileName;
                        var fileName_encode = encodeURI(fileName);

                        // ダウンロード（データ形式をblobを指定）
                        ncmb.File.download(fileName_encode, "blob")
                                      .then(function(blob) {
                                          // ファイルダウンロード成功時の処理
                                          var reader = new FileReader();
                                          reader.onload = function(e) {
                                              // 画像URLを設定
                                              var dataUrl = reader.result;
                                              document.getElementById(myImageId).src = dataUrl;
                                              //  ファイル名を分解
                                              var fileNameArray = fileName.split('_');
                                              // 作品名を表示
                                              var imageName = "「" + fileNameArray[0] + "」";
                                              document.getElementById(myTitleId).innerHTML = imageName;
                                          }
                                          // ファイルリーダーにデータを渡す
                                          reader.readAsDataURL(blob);                        
                                      
                                          resolve("画像" + i); 
                                      })
                                      .catch(function(error) {
                                          // ファイルダウンロード失敗時の処理
                                          reject("画像" + i);
                                      });
                    });
                };

                function onDeleteHomeScreenPageField() {
                    // フィールドを空に
                    $("#imgName").val("");
                    $("#photo").val("");
                    $("#preview").empty();
                }

                function onDeleteMyPageField() {
                    // フィールドを空に
                    $("#myImage_0").attr("src", "");
                    $("#myImage_1").attr("src", "");
                    $("#myImage_2").attr("src", "");
                    $("#myImage_3").attr("src", "");
                    $("#myTitle_0").html("");
                    $("#myTitle_1").html("");
                    $("#myTitle_2").html("");
                    $("#myTitle_3").html("");
                }
                // 「MY イラスト」ボタン押下時の処理
                  function onMyFilesBtn(){
                      // My イラスト画面へ遷移
                      //$.mobile.changePage('#MyPage');
                      // 画像一覧のダウンロード
                      getMyFileData();
                  }

                  //カメラページ
                  }else if(page.matches('#Camera-page')){
                    var currentUser = ncmb.User.getCurrentUser();
                  if (currentUser) {
                    page.querySelector("ons-back-button").onclick = function () {
                        document.querySelector('#navigator').pushPage('signin.html');
                    };
                  }

                  $(function() {
                      
                      $("#uploadBtn").click(onUploadBtn);

                      $('form').on('change', 'input[type="file"]', function(e) {
                          file = e.target.files[0],
                          reader = new FileReader(),
                          t = this;

                          fileType = file.type.indexOf("image");

                          // 画像ファイル以外の場合は何もしない
                          if(fileType < 0){
                              alert("画像ファイルを選択してください");
                              return false;
                          }

                          // ファイル読み込みが完了した際のイベント登録
                          reader.onload = (function(file) {
                              imgFlag = true;
                              return function(e) {
                              //既存のプレビューを削除
                              $("#preview").empty();
                              // .previewの領域の中にロードした画像を表示するimageタグを追加
                              $("#preview").append($('<img id="photo_image">').attr({
                                  src: e.target.result,
                                  width: "100%",
                                  class: "preview",
                                  title: file.name
                              }));
                            };
                          })(file);

                          reader.readAsDataURL(file);
                        });
                  });

                  function onUploadBtn() {
            // 作品名を取得
            var imgName = $("#imgName").val();
            // 入力チェック
            if (imgName == "") {
                alert("作品名を入力してください");
                return;
            }
            if (imgFlag == false) {
                alert("投稿する写真を選択してください");
                return;
            }

            var img = document.getElementById('photo_image');
            var photoType = $("#photo")[0].files[0].type;
            var base64 = ImageToBase64(img, photoType);
            var photoData = toBlob(base64, photoType);

            // loading の表示
           /* $.mobile.loading('show', {
                text: 'Sending...',
                textVisible: true,
                theme: 'a',
                textonly: false,
                html: ''
            });*/

            // uuidを生成
            var uuid = makeUUID();
            // 選択した画像のファイル名を取得
            var fileName = $("#photo")[0].files[0].name;
            var sp = fileName.split('.');
            // 選択した画像の拡張子を取得
            var fileName_type = sp[sp.length-1];
            // 作品名をエンコード
            imgName = encodeURIComponent(imgName);
            // カレントユーザーのユーザー名を取得
            var currentUserName = currentUser.get("userName");
            // 作品の保存名を作成「作品名_作者名_uuid.拡張子」
            var photoName = imgName + "_" + currentUserName + "_" + uuid + "." + fileName_type;

            // 参照権限（ACL）を生成
            var acl = new ncmb.Acl();
            // 全員「読み込み可」、特定のユーザーのみの「書き込み可」で設定
            acl.setPublicReadAccess(true)
                .setUserReadAccess(currentUser, true)
                .setUserWriteAccess(currentUser, true);

            // 写真アップロード
            ncmb.File
                    .upload(photoName, photoData, acl)
                    .then(function(result){
                        // アップロード成功時の処理
                        alert("アップロード成功");
                        console.log("アップロード成功");
                        // フィールドを空に
                        onDeleteHomeScreenPageField
                        onLoadFunc3();
                        document.querySelector("#navigator").popPage();
                        
                    })
                    .catch(function(error){
                        // アップロード失敗時の処理
                        alert("アップロード失敗：" + error);
                        console.log("アップロード失敗：" + error);
                        
                    });
        }

        


      //ボディチェックページの処理
      }else if(page.matches('#weight-page')){
        var Weight = ncmb.DataStore("weight");
        var currentUser = ncmb.User.getCurrentUser();
        
        var date = new Date();
        if (currentUser) { 
          //ログアウト処理
          page.querySelector("ons-back-button").onclick = function () {
            ncmb.User.logout();
            document.querySelector('#navigator').pushPage('signin.html');
          };

          onWeight();

          //設定ボタンを押した時の処理
          page.querySelector("#weight-button").onclick = function() {
            var weight = new Weight;
            //体重の登録
            weight.set("weight", document.getElementById("weight-inp").value)
                .set("date",date)
                .set("user_id",currentUser.get("objectId"))
                .save()
                .then(function(object)
                {
                    onWeight();
                });
            //ページの読み込み
          }
        };
      //カロリータンパク質ページの処理
      }else if(page.matches('#nutrition-page')){
        var date = new Date;
        var currentUser = ncmb.User.getCurrentUser();
        if (currentUser) {
            //バックボタンを押した時の処理追加
            page.querySelector("ons-back-button").onclick = function () {
              document.querySelector('#navigator').pushPage('signin.html');
            };
            //記録ボタンを押した時の処理追加
            page.querySelector("#nut-button").onclick = function(){
            var nutrition = new Nutrition;
            //入力数値取得
            var inpcal = document.getElementById("cal").value;
            var inppro = document.getElementById("protain").value;
            //バリデーションチェック
            if(inpcal == 0 && inppro == 0){
                document.getElementById("valnu").textContent = 'どちらか必ず入力してください';
            }else if(isNaN(inpcal)){  //数字以外の入力
                document.getElementById("valcal").textContent = '数字で入力してください';
            }else if(isNaN(inppro)){
                document.getElementById("valpro").textContent = '数字で入力してください';
            }else{
                document.getElementById("valnu").textContent = '';
                document.getElementById("valcal").textContent = '';
                document.getElementById("valpro").textContent = '';

                //カロリータンパク質登録(カロリー、タンパク質、今日の日付、ログイン中のユーザ)追加
                nutrition.set("cal", document.getElementById("cal").value)
                        .set("protain", document.getElementById("protain").value)
                        .set("date", date)
                        .set("user_id", currentUser.get("objectId"))
                        .save()
                    .catch(function(error){
                        console.log(error);
                    });
                    //meterバーの割合数字、valueの値が割合の値になる追加
                document.getElementById("cal-meter").value = document.getElementById("cal").value;
                document.getElementById("pro-meter").value = document.getElementById("protain").value;
            }
            };
        }
      //プロフィールページの処理
      }else if(page.matches('#profile-page')){
          var currentUser = ncmb.User.getCurrentUser();
          var Profile = ncmb.DataStore("profile");
          var Weight = ncmb.DataStore("weight");
          var profile = new Profile;
          var weight = new Weight;
          var date = new Date();

          // ログアウト処理
          page.querySelector("ons-back-button").onclick = function () {
            ncmb.User.logout();
            document.querySelector('#navigator').pushPage('signin.html');
          };
          // 身長レンジスライダーを動かすと身長テキストボックスに入力される
          page.querySelector("#pro-height-range").onclick = function() {
            document.getElementById('pro-height-inp').value=this.value;
          }
          // 体重レンジスライダーを動かすと体重テキストボックスに入力される
          page.querySelector("#pro-weight-range").onclick = function() {
            document.getElementById('pro-weight-inp').value=this.value;
          }
          //設定ボタンを押した時の処理
          page.querySelector("#register-button").onclick = function() {
            var proHeight = document.getElementById("pro-height-inp").value;
            var proWeight = document.getElementById("pro-weight-inp").value;

            //バリデーションチェック
            if(isNaN(proHeight)){  //数字以外の入力
                document.getElementById("pro-err").textContent = '数字5桁以内で入力してください';
            }else if(proHeight == 0 || proHeight == null){  //未入力
                document.getElementById("pro-err").textContent = '必ず入力してください';
            }else if(String(proHeight).length > 5){  //5桁以上の入力
                document.getElementById("pro-err").textContent = '数字5桁以内で入力してください';
            }else if(isNaN(proWeight)){  //数字以外の入力
                document.getElementById("pro-err").textContent = '数字5桁以内で入力してください';
            }else if(proWeight == 0){  //未入力
                document.getElementById("pro-err").textContent = '必ず入力してください';
            }else if(String(proWeight).length > 5){  //5桁以上の入力
                document.getElementById("pro-err").textContent = '数字5桁以内で入力してください';
            }else{
                document.getElementById("pro-err").textContent = '';
                //体重の登録
                profile.set("height", proHeight)
                      .set("user_id",currentUser.get("objectId"))
                      .save();
                weight.set("weight", proWeight)
                      .set("date",date)
                      .set("user_id",currentUser.get("objectId"))
                      .save();
            
                //BMIの計算
                var bmi = (proWeight) / (proHeight/100) / (proHeight/100);
                bmi = Math.round(bmi * 10) / 10;
                //pタグに出力
                document.getElementById("pro-bmi").textContent = bmi;
                //ページの読み込み
                document.querySelector("ons-tab[page='profile.html']").click();
                //location.reload();
            }
          }
        };
    });
    if (ons.platform.isIPhoneX()) {
      document.documentElement.setAttribute('onsflag-iphonex-portrait', '');
      document.documentElement.setAttribute('onsflag-iphonex-landscape', '');
    }
    //ボディチェック画面表示処理
    function onWeight(){
      var currentUser = ncmb.User.getCurrentUser();
      var h = 0;
      if (currentUser) {
        //身長取得
        Profile.equalTo("user_id",currentUser.get("objectId")).fetchAll()
                .then(function(results){
                  for(var i=0; i<results.length; i++){
                    h = results[i].get("height");
                  }
                })
                .catch(function(error){
                  console.log("データなし");
                });
        //グラフ描画【静的データ】
        var chartdata = {
          labels: [],
          datasets: [
            {
              label: "体重",
              backgroundColor:'rgba(0,0,0,0)',
              borderColor: 'rgba(75,192,192,1)',
              data: [],
            }]
        };
        //体重データ取得
        Weight.order("date",false)
              .equalTo("user_id",currentUser.get("objectId"))
              .fetchAll()
              .then(function(results){
                  for (var i=0; i<results.length; i++) {
                    chartdata.labels[i] = i+1;
                    chartdata.datasets[0].data[i] = results[i].get("weight");
                    //日付の取得、表示
                    var select_weight = results[i].get("weight");
                    //BMIの計算
                    var defbmi = select_weight / (h/100) / (h/100);
                    defbmi = Math.round(defbmi * 10) / 10;
                    //pタグに出力
                    document.getElementById("bmi").textContent = defbmi;
                  }
                  var ctx = document.getElementById("myChart").getContext("2d");
                  var options = { };
                  var lineChart = new Chart(ctx,{
                    type:'line',
                    data:chartdata,
                    options:{
                          //
                          // responsive: false,
                      responsive:true,
                      maintainAspectRatio: false
                    }
                  });
              })
              .catch(function(err){
                console.log(err);
              });
      }
    }
    //目標画面一覧用処理
    function onLoadFunc(){
      var currentUser = ncmb.User.getCurrentUser();
      if (currentUser) {
        //一旦カードをすべて消去する
          var maincont = document.getElementById('goaldiv');
          var subcont = document.getElementById('targetdiv');
          if (maincont.hasChildNodes()){
            for (var i=maincont.childNodes.length-1; i>=0; i--) {
              maincont.removeChild(maincont.childNodes[i]);
            }
          }
          if (subcont.hasChildNodes()){
            for (var i=subcont.childNodes.length-1; i>=0; i--) {
              subcont.removeChild(subcont.childNodes[i]);
            }
          }
          //flagがfalseのデータを全件取得
          Goal.equalTo("flag", false)
              .equalTo("user_id",currentUser.get("objectId"))
              .fetchAll()
            .then(function(results){
              //取得データがある間
              for(var i = 0; i < results.length; i++){
                //カード作成
                var onscard = document.createElement('ons-card');
                onscard.style.cssText ="background-color:yellow;"+"text-align:center;"+"width:90%;"+"margin:20px auto;";
                //pタグ作成
                var cardp = document.createElement('p');
                cardp.style.cssText = "display:inline;";
                cardp.innerHTML = results[i].goal;
                onscard.appendChild(cardp);
                //ボタンを作成
                var cardbutton = document.createElement('ons-button');
                cardbutton.setAttribute("modifier");
                cardbutton.innerHTML = "達成";
                cardbutton.style.cssText = "background-color:#00ff7f;"+"color:black;"+"font-size:12pt"+"display:inline;"+"margin-left:20px;";
                //ボタンを押した時の処理
                cardbutton.onclick = (function(objid){
                return function(){
                  btnUpdate(objid);
                }
              })(results[i].objectId);
                onscard.appendChild(cardbutton);
                maincont.appendChild(onscard);
              }
            })
            .catch(function(error){
              alert("エラーです");
            });
          //達成ボタンを押下した時の処理
          function btnUpdate(objid){
            Goal.equalTo("objectId",objid)
                .fetch()
                .then(function(results){
                  results.set("flag",true);
                  results.update();
                  onLoadFunc(); //画面再読み込み
                })
                .catch(function(error){
                  alert("更新エラー")
                });
          }

          //flagがtrueのデータを全件取得
          Goal.equalTo("flag", true)
              .equalTo("user_id",currentUser.get("objectId"))
              .fetchAll()
            .then(function(results){
              //取得データがある間
              for(var i = 0; i < results.length; i++){
                //カード作成
                var onscard = document.createElement('ons-card');
                onscard.style.cssText = "background-color:#00ff7f;"+"text-align:center;"+"width:90%;"+"margin:20px auto;";
                var cardp = document.createElement('p');
                cardp.innerHTML = results[i].goal;
                onscard.appendChild(cardp);
                subcont.appendChild(onscard);
              }
            })
            .catch(function(error){
              alert("エラーです");
            });
        }
    }

    //カメラ画像処理
      function ImageToBase64(img, mime_type) {
      // New Canvas
      var canvas = document.createElement('canvas');
      canvas.width  = img.width;
      canvas.height = img.height;
      // Draw Image
      var ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, img.width, img.height);
      // To Base64
      return canvas.toDataURL(mime_type);
  }

  function toBlob(base64, mime_type) {
      var bin = atob(base64.replace(/^.*,/, ''));
      var buffer = new Uint8Array(bin.length);
      for (var i = 0; i < bin.length; i++) {
          buffer[i] = bin.charCodeAt(i);
      }
      // Blobを作成
      try{
          var blob = new Blob([buffer.buffer], {
              type: mime_type
          });
      }catch (e){
          return false;
      }
      return blob;
  }

  // UUID生成
  function makeUUID() {
      var d = + new Date();
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'
          .replace(/[xy]/g, function(c) {
              var r = (d + Math.random() * 16) % 16 | 0;
              return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);
          });
  }

 
   
  </script>
</head>
<style>
body {
	.page__background {
  background-image:url("img/fitness.JPG");
}


</style>

<!--中身-->
<body>
  <!-- 初期ページの設定 -->
  <!-- page="######.html"の#部分を自分の画面に変更 -->
  <ons-navigator id="navigator" var="app.navi" page="signin.html"></ons-navigator>

  <!-- 共通画面 -->
  <ons-template id="common.html">
    <ons-page id="common-page" class="background" src="img/fitness.JPG">
      <ons-tabbar>
        <ons-tab page="goal.html" icon="fa-flag"></ons-tab>
        <ons-tab page="schedule.html" icon="fa-calendar"></ons-tab>
        <ons-tab page="album.html" icon="fa-picture-o"></ons-tab>
        <ons-tab page="weight.html" icon="fa-line-chart"></ons-tab>
        <ons-tab page="nutrition.html" icon="fa-cutlery"></ons-tab>
        <ons-tab page="profile.html" icon="fa-user-circle-o"></ons-tab>
      </ons-tabbar>
    </ons-page>
  </ons-template>

  <!--新規登録画面-->
  <ons-template id="signup.html">
    <ons-page id="signup-page">
      <div class="background" style="background-image: yellow;"></div>
      <div class="content" style="text-align: center;" >
        <img src="img/logo.png" style="width:250px; height:250px">
        <p style="bold; margin-top:30px;font-size:20px">新規登録</p>
        <div class="signup">
          <p style="text-align:left; margin-left:85px;">ユーザー名</p>
          <ons-input id="newusername" placeholder="username" modifier="underbar" style="background-color:white;"></ons-input>
          <p style="text-align:left; margin-left:85px">パスワード</p>
          <ons-input id="newpassword" placeholder="password" modifier="underbar" style="background-color:white"></ons-input><br>
        </div>
        <br>
        <ons-button id="signup-button" style="background-color:white; color:black;border-width:1px">新規登録</ons-button><br>
        <ons-button id="signin-button" modifier="quiet">ログインはこちら</ons-button>
      </div>
    </ons-page>
  </ons-template>

  <!--ログイン画面-->
  <ons-template id="signin.html">
    <ons-page id="signin-page">
    <div class="background" style="background-color: yellow;"></div>
      <div class="content" style="text-align: center;" >
        <img src="img/logo.png" style="width:250px; height:250px">
        <p style="bold; margin-top:30px;font-size:20px">ログイン</p>
        <div class="signup">
          <p style="text-align:left; margin-left:85px;">ユーザー名</p>
          <ons-input id="username" placeholder="username" modifier="underbar" style="background-color:white;"></ons-input>
          <p style="text-align:left; margin-left:85px">パスワード</p>
          <ons-input id="password" placeholder="password" modifier="underbar" style="background-color:white"></ons-input><br>
        </div>
        <br>
        <ons-button id="signin-button" style="background-color:white; color:black;border-width:1px">ログイン</ons-button><br>
        <ons-button id="signup-button" modifier="quiet">新規登録はこちら</ons-button>
      </div>
    </ons-page>
  </ons-template>

  <!---目標一覧画面-->
  <ons-template id="goal.html">
    <ons-page id="goal-page">
      <ons-toolbar style="background-color:yellow;">
        <div class="left"><ons-back-button>logout</ons-back-button></div>
        <div class="center">目標一覧</div>
      </ons-toolbar>
      <div class="background" style="background-color:white;"></div>
      <div id="goaldiv"></div>
      <div id="targetdiv"></div>
      <ons-button id="newgoal-button" style="text-align:center; position:fixed; left:60px; right:60px ;bottom:40px; background-color:#ffff00; color:#000000; border-width:1px;">+目標を追加する</ons-button>
    </ons-page>
  </ons-template>

  <!-- 目標登録画面 -->
  <ons-template id="newgoal.html">
    <ons-page id="newgoal-page">
      <ons-toolbar style="background-color:yellow;">
      <div class="left"><ons-back-button></ons-back-button></div>
      <div class="center">目標登録</div>
      </ons-toolbar>
      <div class="background" style="background-image:url(img/fitness.JPG);"></div>
      <div style="text-align:center; margin-top:150px;">
      <textarea id="target" class="textarea" rows="3" placeholder="目標を入力" style="height:150px; width:250px; border:1px solid #000000; background-color:white;"></textarea>
      </div>

      <p id="eee" style="text-align:center; color:red"></p>

      <ons-button id="new-button" style="text-align:center; position: fixed; left:60px; right:60px ;bottom:120px; background-color:#ffff00; color:#000000; border-width:1px;">追加</ons-button>
    </ons-page>
  </ons-template>

  <!--スケジュール画面-->
  <ons-template id="schedule.html">
    <ons-page id="schedule-page">
      <div class="background" style="background-color:white;""></div>
      <ons-toolbar style="background-color: yellow;">
        <div class="left"><ons-back-button>logout</ons-back-button></div>
        <div class="center">スケジュール</div>
        </div>
      </ons-toolbar>
      <div style="position:relative; width:100%; height:90%;">
        <div class ="month" style="text-align: center;">
          <h1> <span id="currentDate"></span></h1>
        </div>
        <div id="divSdlCal"></div>
        <div style="text-align: center; position:absolute;bottom:20px;width:100%;"> 
          <ons-button id="back-button" style="background-color:silver;color:black; text-align:left">◀BACK</ons-button> 
          <ons-button id="next-button" style=" text-align:right;background-color: silver; color:black">NEXT▶</ons-button> 
        </div> 
      </div>
    </ons-page>
  </ons-template>
  <!---スケジュール詳細画面-->
  <ons-template id="scheduledetail.html">
    <ons-page id="scheduledetail-page">
      <div class="background" style="background-color: white;"></div>
      <ons-toolbar  style="background-color: yellow;">
        <div class="left"><ons-back-button></ons-back-button></div>
        <div class="center">スケジュール詳細</div>
      </ons-toolbar>
      <div style="position:relative; width:100%; height:90%;">
        <div class ="month" style="text-align: center;">
          <h1> <span id="currentDate2"></span></h1>
        </div>
        <div id ="detaildiv"></div>
        
      </div>
      <ons-button id="newschedulebutton" style="text-align:center; position: fixed; left:60px; right:60px ;bottom:100px; background-color:#ffff00; color:#000000; border-width:1px; border-radius:10px;">追加</ons-button>
    </ons-page>
  </ons-template>
  <!--スケジュール登録画面-->
  <ons-template id="scheduleregister.html">
    <ons-page id="scheduleregister-page">
      <div class="background" style="background-color: white;"></div>
      <ons-toolbar style="background-color: yellow;">
        <div class="left"><ons-back-button></ons-back-button></div>
        <div class="center">スケジュール追加</div>
      </ons-toolbar>

      <div style="position:relative; width:100%; height:90%;">
      <div style="text-align:center; margin-top:15px;">
        <h1> <span id="currentDate3"></span></h1>
      </div>
      <div style="text-align:center; margin-top:150px;">
      <textarea id="target" class="textarea" rows="1" placeholder="トレーニング内容" style="height:50px; width:250px;"></textarea>
      </div>
      <p id="weival" style="font-size:10pt;color:red;text-align:center;"></p>
      <ons-button id="newschedulebutton" style="text-align:center; position: fixed; left:60px; right:60px ;bottom:100px; background-color:#ffff00; color:#000000; border-width:1px;">登録</ons-button>
      </div>
    </ons-page>
  </ons-template>
  <!---カメラ画面-->
  <ons-template id="Camera.html">
    <ons-page id="Camera-page">
      <ons-toolbar style="background-color:yellow">
        <div class="left"><ons-back-button>アルバム</ons-back-button></div>
        <div class="center">カメラ </div>
      </ons-toolbar>
      
        <div class="content" style="text-align: center">

          <p><center><h2>あなたの写真を<br>upしましょう！</h2></center></p><br>
                        <input id="imgName" type="text" placeholder="タイトルを入力">
                        <br>
                        <br>
                        
                        <div>
                            <form>
                                <input id="photo" type="file" accept="image/*">
                            </form>
                                <center><div id="preview"></div></center>
                        </div>
                    <input id="uploadBtn" type="button" value="アップロード" >

                    
                
        </div>
    </ons-page>
  </ons-template>
 <!---アルバム画面-->
  <ons-template id="album.html">
    <ons-page id="album-page">
      <ons-toolbar style="background-color:yellow">
        <div class="left"><ons-back-button>logout</ons-back-button></div>
        <div class="center">アルバム</div>
        <div class="right"><ons-button id="camerachange-button">camera</ons-button></div>
        <!--<a href="#" id="myFilesBtn" data-role="button" data-inline="true" data-transition="flow" data-theme="b">マイフォト</a>-->
        
      </ons-toolbar>
      
    <!-- アルバムタブ機能＆中央部 -->
            <section data-role="content">
                <center>
                    <!-- 画像表示 -->
                    <table border="1" width="98%">
                        <tr height="200px">
                            <td width="49%">
                                <center>
                                    <img src="" id="myImage_0" width="75%"/><br>
                                    <span id="myTitle_0"></span><br>
                                </center>
                            </td>
                            <td width="49%">
                                <center>
                                    <img src="" id="myImage_1" width="75%"/><br>
                                    <span id="myTitle_1"></span><br>
                                </center>
                            </td>
                        </tr>
                        <tr height="200px">
                            <td width="49%">
                                <center>
                                    <img src="" id="myImage_2" width="75%"/><br>
                                    <span id="myTitle_2"></span><br>
                                </center>
                            </td>
                            <td width="49%">
                                <center>
                                    <img src="" id="myImage_3" width="75%"/><br>
                                    <span id="myTitle_3"></span><br>
                                </center>
                            </td>
                        </tr>
                        <tr height="200px">
                            <td width="49%">
                                <center>
                                    <img src="" id="myImage_4" width="75%"/><br>
                                    <span id="myTitle_4"></span><br>
                                </center>
                            </td>
                            <td width="49%">
                                <center>
                                    <img src="" id="myImage_5" width="75%"/><br>
                                    <span id="myTitle_5"></span><br>
                                </center>
                            </td>
                        </tr>
                        <tr height="200px">
                            <td width="49%">
                                <center>
                                    <img src="" id="myImage_6" width="75%"/><br>
                                    <span id="myTitle_6"></span><br>
                                </center>
                            </td>
                            <td width="49%">
                                <center>
                                    <img src="" id="myImage_7" width="75%"/><br>
                                    <span id="myTitle_7"></span><br>
                                </center>
                            </td>
                        </tr>
                        <tr height="200px">
                            <td width="49%">
                                <center>
                                    <img src="" id="myImage_8" width="75%"/><br>
                                    <span id="myTitle_8"></span><br>
                                </center>
                            </td>
                            <td width="49%">
                                <center>
                                    <img src="" id="myImage_9" width="75%"/><br>
                                    <span id="myTitle_9"></span><br>
                                    
                                </center>
                                
                            </td>
                            
                        </tr>
                        
                    </table>
                </center>
                              
            </section>

            

          
          </ons-page>
  </ons-template>
  <!---ボディチェック画面-->
  <ons-template id="weight.html">
    <ons-page id="weight-page">
      <ons-toolbar style="background-color:yellow">
        <div class="left"><ons-back-button>logout</ons-back-button></div>
        <div class="center">ボディチェック</div>
      </ons-toolbar>
      <div class="background" style="background-color:white"></div>
      <div class="chartWrapper" style="position: relative; overflow-x: scroll; margin-top:30px;">
        <div class="chartContainer" style="height:300px;">
          <canvas id="myChart" style="height:300px; position: absolute; left: 0; top: 0; pointer-events:none;"></canvas>
        </div>
      </div>
      <br><br><br><br>
      <!--体重・BMI-->
      <table style=" margin:auto;font-size:18pt;"><tr>
      <td>体重：</td><td><ons-input id="weight-inp" modifier="underbar"></ons-input></td><td>
      <ons-button id="weight-button">設定</ons-button><br></td></tr><tr>
      <td>BMI：</td><td><p id="bmi"></p></td><td></td></tr>
      </table>
    </ons-page>
  </ons-template>
  <!---カロリータンパク質画面-->
<ons-template id="nutrition.html">
<ons-page id="nutrition-page">
    <div class="background" style="background-color: white;"></div>
<ons-toolbar style="background-color: yellow;">
    <div class="background" style="background-color: white;"></div>
    <div class="left"><ons-back-button>logout</ons-back-button></div>
    <div class="center">カロリータンパク質</div>
</ons-toolbar>

<div class="content" style="text-align: center; font-size:14pt;">
    <!---カロリーバー表示追加-->
    <p>カロリー(Kcal)</p>
    <meter id="cal-meter" max="4000" style="width:70%"></meter>
    <!---タンパクバー質表示追加-->
    <p>タンパク質(g)</p>
    <meter id="pro-meter" max="300" style="width:70%"></meter>
    <!---カロリー入力追加-->
    <p>カロリー</p>
    <input type="text" id="cal">
    <p id="valcal" style="color:red; font-size:10pt;"></p>
    <!---タンパク質入力追加-->
    <p>タンパク質</p>
    <input type="text" id="protain">
    <p id="valpro" style="color:red; font-size:10pt;"></p>
    <p id="valnu" style="color:red; font-size:10pt;"></p>
    <ons-button id="nut-button">記録</ons-button>
  </div>
  </ons-page>
  </ons-template>
    
  <!---プロフィール画面-->
  <ons-template id="profile.html">
    <ons-page id="profile-page">
      <div class="background" style="background-color: white;"></div>
    <ons-toolbar style="background-color: yellow;">
        <div class="left"><ons-back-button>logout</ons-back-button></div>
        <div class="center">プロフィール</div>
      </ons-toolbar>
      <div style="position:relative;width:100%;height:100%;">
        <ons-row>
          <ons-col width="70%">
            <img src="img/profile.png" style="width:100%; height:100%">
          </ons-col>
          <!-- 身長レンジスライダー -->
          <ons-col width="30%">
            <span>　　　200cm</span>
            <input id="pro-height-range" type="range" style="-webkit-appearance:slider-vertical;writing-mode:bt-lr; height:70%;" value="170.0" min="140.0" max="200.0" step="0.1" oninput="document.getElementById('pro-height').value=this.value">
            <span>　　　140</span>
            <output id="pro-height">170.0</output>
          </ons-col>
          <!-- 体重レンジスライダー -->
          <ons-col width="100%">
            <input id="pro-weight-range" type="range" style="width:70%" value="60.0" min="40.0" max="120.0" step="0.1" oninput="document.getElementById('pro-weight').value=this.value">
            <output id="pro-weight" style="position:absolute; right:10%;%">60.0</output><br>
            <span>40</span><span style="position:absolute; right:25%">120kg</span>
          </ons-col>
        </ons-row>

        <!-- 身長・体重テキストボックス -->
        <p id="pro-err" style="font-size:10pt;color:red;text-align:center;"></p>
        <table style=" margin:auto;font-size:18pt;">
          <tr>
            <th>身長：</th>
            <td><ons-input id="pro-height-inp" modifier="underbar" min="140.0" max="200.0" step="0.1"></ons-input></td>
          </tr>
          <tr>
            <th>体重：</th>
            <td><ons-input id="pro-weight-inp" modifier="underbar" min="40.0" max="120.0" step="0.1"></ons-input></td>
          </tr>
          <tr>
            <th>BMI：</th>
            <td><p id="pro-bmi"></p></td>
          </tr>
          <tr align="center">
            <td rowspan="2">
              <ons-button id="register-button">設定</ons-button>
            </td>
          </tr>
        </table>



        </div>
      </div>
    </ons-page>
  </ons-template>

</body>
</html>